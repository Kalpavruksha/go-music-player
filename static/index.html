<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Go Music Player</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#8B5CF6',
                        secondary: '#EC4899',
                        dark: '#121212',
                        darker: '#0A0A0A',
                        light: '#FAFAFA'
                    }
                }
            }
        }
        
    </script>
    <style>
        body {
            background: linear-gradient(135deg, #1a1a1a 0%, #0a0a0a 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .song-button {
            transition: all 0.3s ease;
        }
        .song-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
        }
        .playing {
            background: linear-gradient(90deg, #8B5CF6, #EC4899);
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(139, 92, 246, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(139, 92, 246, 0); }
            100% { box-shadow: 0 0 0 0 rgba(139, 92, 246, 0); }
        }
        .progress-bar::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #8B5CF6;
            cursor: pointer;
        }
        .progress-bar::-moz-range-thumb {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #8B5CF6;
            cursor: pointer;
        }
        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #EC4899;
            cursor: pointer;
        }
        .volume-slider::-moz-range-thumb {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #EC4899;
            cursor: pointer;
        }
    </style>
</head>
<body class="text-light">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <header class="text-center mb-12">
            <h1 class="text-4xl md:text-5xl font-bold bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent mb-2">
                <i class="fas fa-music mr-3"></i>Go Music Player
            </h1>
            <p class="text-gray-400">Stream your favorite songs directly from your local collection</p>
        </header>

        <!-- Main Content -->
        <div class="flex flex-col lg:flex-row gap-8">
            <!-- Song List Section -->
            <div class="lg:w-2/3">
                <div class="bg-darker rounded-2xl p-6 shadow-2xl">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold flex items-center">
                            <i class="fas fa-list mr-2 text-primary"></i>Song Library
                        </h2>
                        <div class="relative">
                            <input type="text" id="search-input" placeholder="Search songs..." 
                                class="bg-gray-900 text-white rounded-full py-2 px-4 pl-10 focus:outline-none focus:ring-2 focus:ring-primary w-40 md:w-64">
                            <i class="fas fa-search absolute left-3 top-3 text-gray-500"></i>
                        </div>
                    </div>

                    <div id="song-list" class="space-y-3 max-h-[500px] overflow-y-auto pr-2">
                        <div class="text-center py-10 text-gray-500">
                            <i class="fas fa-spinner fa-spin text-3xl mb-3"></i>
                            <p>Loading songs...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Player Section -->
            <div class="lg:w-1/3">
                <div class="bg-darker rounded-2xl p-6 shadow-2xl sticky top-6">
                    <h2 class="text-2xl font-bold mb-6 text-center flex items-center justify-center">
                        <i class="fas fa-compact-disc mr-2 text-primary"></i>Now Playing
                    </h2>
                    
                    <!-- Album Art Placeholder -->
                    <div class="bg-gradient-to-br from-primary/20 to-secondary/20 rounded-xl p-8 mb-6 flex items-center justify-center">
                        <div class="bg-gray-800 rounded-full w-48 h-48 flex items-center justify-center">
                            <i class="fas fa-music text-6xl text-gray-600"></i>
                        </div>
                    </div>

                    <!-- Song Info -->
                    <div class="text-center mb-6">
                        <h3 id="current-song-title" class="text-xl font-bold truncate">No song selected</h3>
                        <p id="current-song-artist" class="text-gray-400">Select a song to play</p>
                    </div>

                    <!-- Progress Bar -->
                    <div class="mb-4">
                        <div class="flex justify-between text-sm text-gray-400 mb-1">
                            <span id="current-time">0:00</span>
                            <span id="total-time">0:00</span>
                        </div>
                        <input type="range" id="progress-bar" class="progress-bar w-full h-1.5 bg-gray-700 rounded-lg appearance-none cursor-pointer" 
                            value="0" min="0" max="100">
                    </div>

                    <!-- Player Controls -->
                    <div class="flex justify-center items-center space-x-6 mb-6">
                        <button id="shuffle-btn" class="text-gray-400 hover:text-white">
                            <i class="fas fa-random text-xl"></i>
                        </button>
                        <button id="prev-btn" class="text-gray-400 hover:text-white">
                            <i class="fas fa-step-backward text-xl"></i>
                        </button>
                        <button id="play-btn" class="bg-primary hover:bg-purple-600 rounded-full w-14 h-14 flex items-center justify-center">
                            <i class="fas fa-play text-xl"></i>
                        </button>
                        <button id="next-btn" class="text-gray-400 hover:text-white">
                            <i class="fas fa-step-forward text-xl"></i>
                        </button>
                        <button id="repeat-btn" class="text-gray-400 hover:text-white">
                            <i class="fas fa-redo text-xl"></i>
                        </button>
                    </div>

                    <!-- Volume Control -->
                    <div class="flex items-center space-x-3">
                        <i class="fas fa-volume-down text-gray-400"></i>
                        <input type="range" id="volume-slider" class="volume-slider w-full h-1.5 bg-gray-700 rounded-lg appearance-none cursor-pointer" 
                            value="80" min="0" max="100">
                        <i class="fas fa-volume-up text-gray-400"></i>
                    </div>

                    <!-- Hidden Audio Element -->
                    <audio id="audio-player" class="hidden"></audio>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="mt-12 text-center text-gray-500 text-sm">
            <p>Go Music Player &copy; 2023 | Built with Go and Tailwind CSS</p>
        </footer>
    </div>

    <script>
        // DOM elements
        const audioPlayer = document.getElementById('audio-player');
        const songListContainer = document.getElementById('song-list');
        const currentSongTitle = document.getElementById('current-song-title');
        const currentSongArtist = document.getElementById('current-song-artist');
        const progressBar = document.getElementById('progress-bar');
        const currentTimeDisplay = document.getElementById('current-time');
        const totalTimeDisplay = document.getElementById('total-time');
        const playBtn = document.getElementById('play-btn');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const volumeSlider = document.getElementById('volume-slider');
        const shuffleBtn = document.getElementById('shuffle-btn');
        const repeatBtn = document.getElementById('repeat-btn');
        const searchInput = document.getElementById('search-input');

        // State variables
        let songs = [];
        let currentSongIndex = -1;
        let isPlaying = false;
        let isShuffle = false;
        let isRepeat = false;

        // Fetch and display songs
        async function loadSongs() {
            try {
                const response = await fetch('/songs');
                songs = await response.json();
                
                if (songs.length === 0) {
                    songListContainer.innerHTML = `
                        <div class="text-center py-10">
                            <i class="fas fa-music-slash text-4xl text-gray-600 mb-3"></i>
                            <p class="text-gray-500">No songs found</p>
                            <p class="text-gray-600 text-sm mt-2">Add MP3 files to the songs folder</p>
                        </div>
                    `;
                    return;
                }
                
                renderSongList(songs);
            } catch (error) {
                songListContainer.innerHTML = `
                    <div class="text-center py-10">
                        <i class="fas fa-exclamation-triangle text-4xl text-yellow-500 mb-3"></i>
                        <p class="text-gray-500">Error loading songs</p>
                        <p class="text-gray-600 text-sm mt-2">Make sure the server is running</p>
                    </div>
                `;
                console.error('Error loading songs:', error);
            }
        }

        // Render song list
        function renderSongList(songsToRender) {
            songListContainer.innerHTML = '';
            
            songsToRender.forEach((song, index) => {
                const songElement = document.createElement('div');
                songElement.className = `song-button bg-gray-900 hover:bg-gray-800 rounded-xl p-4 cursor-pointer flex items-center group ${currentSongIndex === index ? 'playing' : ''}`;
                songElement.innerHTML = `
                    <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-primary to-secondary flex items-center justify-center mr-4">
                        <i class="fas fa-music text-white"></i>
                    </div>
                    <div class="flex-1 min-w-0">
                        <h3 class="font-medium truncate">${song.name}</h3>
                        <p class="text-gray-400 text-sm truncate">${song.file}</p>
                    </div>
                    <div class="opacity-0 group-hover:opacity-100 transition-opacity">
                        <i class="fas fa-play text-primary"></i>
                    </div>
                `;
                songElement.onclick = () => playSong(index);
                songListContainer.appendChild(songElement);
            });
        }

        // Play selected song
        function playSong(index) {
            // Update current song index
            currentSongIndex = index;
            
            // Set audio source to the selected song
            const song = songs[index];
            audioPlayer.src = `/song/${encodeURIComponent(song.file)}`;
            
            // Update UI
            currentSongTitle.textContent = song.name;
            currentSongArtist.textContent = song.file;
            
            // Play the song
            audioPlayer.play()
                .then(() => {
                    isPlaying = true;
                    updatePlayButton();
                    // Re-render song list to show playing state
                    renderSongList(songs);
                })
                .catch(error => {
                    console.error('Error playing song:', error);
                    currentSongTitle.textContent = 'Error playing song';
                    currentSongArtist.textContent = song.name;
                });
        }

        // Update play/pause button
        function updatePlayButton() {
            const playIcon = playBtn.querySelector('i');
            if (isPlaying) {
                playIcon.classList.remove('fa-play');
                playIcon.classList.add('fa-pause');
            } else {
                playIcon.classList.remove('fa-pause');
                playIcon.classList.add('fa-play');
            }
        }

        // Format time (seconds to mm:ss)
        function formatTime(seconds) {
            const min = Math.floor(seconds / 60);
            const sec = Math.floor(seconds % 60);
            return `${min}:${sec < 10 ? '0' : ''}${sec}`;
        }

        // Update progress bar
        function updateProgress() {
            const { currentTime, duration } = audioPlayer;
            if (duration) {
                progressBar.value = (currentTime / duration) * 100;
                currentTimeDisplay.textContent = formatTime(currentTime);
                totalTimeDisplay.textContent = formatTime(duration);
            }
        }

        // Set progress (when user drags slider)
        function setProgress(e) {
            const width = this.clientWidth;
            const clickX = e.offsetX;
            const duration = audioPlayer.duration;
            
            audioPlayer.currentTime = (clickX / width) * duration;
        }

        // Set volume
        function setVolume() {
            audioPlayer.volume = volumeSlider.value / 100;
        }

        // Toggle play/pause
        function togglePlay() {
            if (currentSongIndex === -1 && songs.length > 0) {
                // If no song is playing, play the first one
                playSong(0);
            } else {
                if (isPlaying) {
                    audioPlayer.pause();
                } else {
                    audioPlayer.play();
                }
                isPlaying = !isPlaying;
                updatePlayButton();
            }
        }

        // Play next song
        function playNext() {
            if (songs.length === 0) return;
            
            if (isShuffle) {
                // Play a random song (excluding current)
                let randomIndex;
                do {
                    randomIndex = Math.floor(Math.random() * songs.length);
                } while (randomIndex === currentSongIndex && songs.length > 1);
                playSong(randomIndex);
            } else {
                // Play next song in order
                const nextIndex = (currentSongIndex + 1) % songs.length;
                playSong(nextIndex);
            }
        }

        // Play previous song
        function playPrev() {
            if (songs.length === 0) return;
            
            if (audioPlayer.currentTime > 3) {
                // If more than 3 seconds into song, restart current song
                audioPlayer.currentTime = 0;
            } else {
                // Play previous song
                const prevIndex = (currentSongIndex - 1 + songs.length) % songs.length;
                playSong(prevIndex);
            }
        }

        // Toggle shuffle
        function toggleShuffle() {
            isShuffle = !isShuffle;
            shuffleBtn.classList.toggle('text-primary', isShuffle);
        }

        // Toggle repeat
        function toggleRepeat() {
            isRepeat = !isRepeat;
            repeatBtn.classList.toggle('text-primary', isRepeat);
            audioPlayer.loop = isRepeat;
        }

        // Filter songs based on search input
        function filterSongs() {
            const searchTerm = searchInput.value.toLowerCase();
            const filteredSongs = songs.filter(song => 
                song.name.toLowerCase().includes(searchTerm) || 
                song.file.toLowerCase().includes(searchTerm)
            );
            renderSongList(filteredSongs);
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', () => {
            loadSongs();
        });

        audioPlayer.addEventListener('timeupdate', updateProgress);
        audioPlayer.addEventListener('ended', () => {
            isPlaying = false;
            updatePlayButton();
            
            if (isRepeat) {
                audioPlayer.currentTime = 0;
                audioPlayer.play();
                isPlaying = true;
                updatePlayButton();
            } else {
                playNext();
            }
        });

        progressBar.addEventListener('click', setProgress);
        volumeSlider.addEventListener('input', setVolume);
        playBtn.addEventListener('click', togglePlay);
        prevBtn.addEventListener('click', playPrev);
        nextBtn.addEventListener('click', playNext);
        shuffleBtn.addEventListener('click', toggleShuffle);
        repeatBtn.addEventListener('click', toggleRepeat);
        searchInput.addEventListener('input', filterSongs);

        // Initialize volume
        audioPlayer.volume = volumeSlider.value / 100;
    </script>
</body>
</html>
